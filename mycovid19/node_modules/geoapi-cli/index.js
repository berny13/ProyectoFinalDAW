#!/usr/bin/env node

const meow = require('meow');
const axios = require('axios');
const Table = require('cli-table2');

let table = new Table({
    chars: {
        'top': '═',
        'top-mid': '╤',
        'top-left': '╔',
        'top-right': '╗',
        'bottom': '═',
        'bottom-mid': '╧',
        'bottom-left': '╚',
        'bottom-right': '╝',
        'left': '║',
        'left-mid': '╟',
        'mid': '─',
        'mid-mid': '┼',
        'right': '║',
        'right-mid': '╢',
        'middle': '│'
    }
});

table.push(['Name']);

const help = meow(`
    How to use geoapi-cli

    List available commands
    $ geoapi-cli -l
`);

const list = `
    You can use the following commands:

    Get department name
    $ node index.js -d <number>

    Get all departments
    $ node index.js -d all
`;

let launch = (arg) => {
    if (arg[0] === '-l') {
        console.log(list);
    } else if (arg[0] === '-d') {
        if (arg[1] !== undefined) {
            if (arg[1] == 'all') {
                getAllDepartments();
            } else {
                getDepartmentName(arg[1]);
            }
        } else
            console.log(list);
    } else {
        console.log(list);
    }
}

let getDepartmentName = (number) => {
    axios.get('https://geo.api.gouv.fr/departements/' + number)
        .then((resp) => {
            console.log(`⛰ Department ${number} name is ${resp.data.nom}`);
        }).catch((err) => {
            console.log(`[${err.response.status}] ${err.response.statusText}`);
        });
}

let getAllDepartments = () => {
    axios.get('https://geo.api.gouv.fr/departements?fields=nom,code')
        .then((resp) => {
            resp.data.forEach((el)=>{
                var name = el.nom;
                table.push(name);
            });
            console.log(table.toString());            
        });
}

launch(process.argv.slice(2));